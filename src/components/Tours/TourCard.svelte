<script>
  import { getContext } from "svelte"

  import { FirebaseApp, Collection, Doc, StorageRef } from "sveltefire"

  import { Tour } from "./"
  import { Flight } from "../Tickets"

  import { tourists, passengers, nights, flights } from "../store.js"

  export let tour
  // export let closeFunction

  // let emptyTour = {
  //   id: "",
  //   name: "",
  //   country: "",
  //   city: "",
  //   visa: "",
  //   area: "",
  //   hotel: "",
  // };

  const rate = 87.5

  let background = "img/mayak_zakat.jpg"
  let path = "gs://turfirma-777.appspot.com/images/mayak_vecher.webp"

  let view = false

  const app = getContext("firebase").getFirebase()
  const firestore = app.firestore()
</script>

<div
  class="flex flex-row 
    m-auto mt-14
    w-100 h-60
    bg-transparent text-pale-white relative cursor-pointer
    transition duration-300 delay-5 ease-in-out 
    transform hover:-translate-y-4 bling"
  on:click={() => (view = true)}
>
  <div
    class="p-22 h-55 mt-1 absolute rounded-xl bg-local bg-cover shadow-xl"
    style="background-image: url('{background}')"
  />
  <!-- 
  <StorageRef {path} let:downloadURL let:ref={path} meta let:metadata>
    <img
      class="p-22 h-55 mt-1 absolute rounded-xl shadow-xl "
      src={downloadURL}
      alt="img"
    />

    <div slot="loading">Loading...</div>

    <div slot="fallback">Error</div>
  </StorageRef> -->

  <div class="w-92.5 h-55 bg-dark-gray ml-auto mt-auto rounded-2xl ">
    <div class="pl-40 pt-2 absolute text-base">
      <div class="-space-y-0.5">
        <span class="font-semibold">{tour.name}</span>
        <div>{tour.hotel}</div>
        <div class="text-sm">
          <span>{tour.country}, </span>
          <span class="font-thin">{tour.city}</span>
        </div>

        {#if tour.visa}
          <div class="text-xs text-blue-200">с визой</div>
        {:else}
          <div class="text-xs text-green-200">без визы</div>
        {/if}
      </div>

      <div class="mt-5 flex flex-row space-x-1.5">
        <svg
          width="20"
          height="20"
          viewBox="0 0 25 25"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M10.8999 1.21265C11.4043 -0.404217 13.5952 -0.404217 14.098 1.21265L15.8971 6.99195C16.007 7.34392 16.2207 7.6506 16.5076 7.86816C16.7945 8.08572 17.1399 8.20301 17.4944 8.20329H23.3155C24.9448 8.20329 25.6207 10.3802 24.3042 11.3808L19.5962 14.9517C19.3087 15.1694 19.0947 15.4766 18.9847 15.8292C18.8748 16.1818 18.8746 16.5617 18.9842 16.9144L20.7833 22.6937C21.2877 24.3105 19.5138 25.6571 18.1939 24.6564L13.4859 21.0856C13.1988 20.8679 12.853 20.7507 12.4981 20.7507C12.1432 20.7507 11.7974 20.8679 11.5103 21.0856L6.8023 24.6564C5.48406 25.6571 3.71185 24.3105 4.21459 22.6937L6.01371 16.9144C6.1233 16.5617 6.1231 16.1818 6.01315 15.8292C5.9032 15.4766 5.68915 15.1694 5.40167 14.9517L0.695381 11.3826C-0.62117 10.3819 0.0564418 8.20504 1.68406 8.20504H7.50345C7.85831 8.20514 8.2041 8.08801 8.49132 7.87043C8.77854 7.65285 8.99247 7.34596 9.10248 6.99371L10.9016 1.21441L10.8999 1.21265Z"
            fill="#FAFAFA"
          />
        </svg>
        <svg
          width="20"
          height="20"
          viewBox="0 0 25 25"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M10.8999 1.21265C11.4043 -0.404217 13.5952 -0.404217 14.098 1.21265L15.8971 6.99195C16.007 7.34392 16.2207 7.6506 16.5076 7.86816C16.7945 8.08572 17.1399 8.20301 17.4944 8.20329H23.3155C24.9448 8.20329 25.6207 10.3802 24.3042 11.3808L19.5962 14.9517C19.3087 15.1694 19.0947 15.4766 18.9847 15.8292C18.8748 16.1818 18.8746 16.5617 18.9842 16.9144L20.7833 22.6937C21.2877 24.3105 19.5138 25.6571 18.1939 24.6564L13.4859 21.0856C13.1988 20.8679 12.853 20.7507 12.4981 20.7507C12.1432 20.7507 11.7974 20.8679 11.5103 21.0856L6.8023 24.6564C5.48406 25.6571 3.71185 24.3105 4.21459 22.6937L6.01371 16.9144C6.1233 16.5617 6.1231 16.1818 6.01315 15.8292C5.9032 15.4766 5.68915 15.1694 5.40167 14.9517L0.695381 11.3826C-0.62117 10.3819 0.0564418 8.20504 1.68406 8.20504H7.50345C7.85831 8.20514 8.2041 8.08801 8.49132 7.87043C8.77854 7.65285 8.99247 7.34596 9.10248 6.99371L10.9016 1.21441L10.8999 1.21265Z"
            fill="#FAFAFA"
          />
        </svg>
        <svg
          width="20"
          height="20"
          viewBox="0 0 25 25"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M10.8999 1.21265C11.4043 -0.404217 13.5952 -0.404217 14.098 1.21265L15.8971 6.99195C16.007 7.34392 16.2207 7.6506 16.5076 7.86816C16.7945 8.08572 17.1399 8.20301 17.4944 8.20329H23.3155C24.9448 8.20329 25.6207 10.3802 24.3042 11.3808L19.5962 14.9517C19.3087 15.1694 19.0947 15.4766 18.9847 15.8292C18.8748 16.1818 18.8746 16.5617 18.9842 16.9144L20.7833 22.6937C21.2877 24.3105 19.5138 25.6571 18.1939 24.6564L13.4859 21.0856C13.1988 20.8679 12.853 20.7507 12.4981 20.7507C12.1432 20.7507 11.7974 20.8679 11.5103 21.0856L6.8023 24.6564C5.48406 25.6571 3.71185 24.3105 4.21459 22.6937L6.01371 16.9144C6.1233 16.5617 6.1231 16.1818 6.01315 15.8292C5.9032 15.4766 5.68915 15.1694 5.40167 14.9517L0.695381 11.3826C-0.62117 10.3819 0.0564418 8.20504 1.68406 8.20504H7.50345C7.85831 8.20514 8.2041 8.08801 8.49132 7.87043C8.77854 7.65285 8.99247 7.34596 9.10248 6.99371L10.9016 1.21441L10.8999 1.21265Z"
            fill="#FAFAFA"
          />
        </svg>
        <svg
          width="20"
          height="20"
          viewBox="0 0 25 25"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M10.8999 1.21265C11.4043 -0.404217 13.5952 -0.404217 14.098 1.21265L15.8971 6.99195C16.007 7.34392 16.2207 7.6506 16.5076 7.86816C16.7945 8.08572 17.1399 8.20301 17.4944 8.20329H23.3155C24.9448 8.20329 25.6207 10.3802 24.3042 11.3808L19.5962 14.9517C19.3087 15.1694 19.0947 15.4766 18.9847 15.8292C18.8748 16.1818 18.8746 16.5617 18.9842 16.9144L20.7833 22.6937C21.2877 24.3105 19.5138 25.6571 18.1939 24.6564L13.4859 21.0856C13.1988 20.8679 12.853 20.7507 12.4981 20.7507C12.1432 20.7507 11.7974 20.8679 11.5103 21.0856L6.8023 24.6564C5.48406 25.6571 3.71185 24.3105 4.21459 22.6937L6.01371 16.9144C6.1233 16.5617 6.1231 16.1818 6.01315 15.8292C5.9032 15.4766 5.68915 15.1694 5.40167 14.9517L0.695381 11.3826C-0.62117 10.3819 0.0564418 8.20504 1.68406 8.20504H7.50345C7.85831 8.20514 8.2041 8.08801 8.49132 7.87043C8.77854 7.65285 8.99247 7.34596 9.10248 6.99371L10.9016 1.21441L10.8999 1.21265Z"
            fill="#FAFAFA"
          />
        </svg>
        <svg
          width="20"
          height="20"
          viewBox="0 0 25 25"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M10.8999 1.21265C11.4043 -0.404217 13.5952 -0.404217 14.098 1.21265L15.8971 6.99195C16.007 7.34392 16.2207 7.6506 16.5076 7.86816C16.7945 8.08572 17.1399 8.20301 17.4944 8.20329H23.3155C24.9448 8.20329 25.6207 10.3802 24.3042 11.3808L19.5962 14.9517C19.3087 15.1694 19.0947 15.4766 18.9847 15.8292C18.8748 16.1818 18.8746 16.5617 18.9842 16.9144L20.7833 22.6937C21.2877 24.3105 19.5138 25.6571 18.1939 24.6564L13.4859 21.0856C13.1988 20.8679 12.853 20.7507 12.4981 20.7507C12.1432 20.7507 11.7974 20.8679 11.5103 21.0856L6.8023 24.6564C5.48406 25.6571 3.71185 24.3105 4.21459 22.6937L6.01371 16.9144C6.1233 16.5617 6.1231 16.1818 6.01315 15.8292C5.9032 15.4766 5.68915 15.1694 5.40167 14.9517L0.695381 11.3826C-0.62117 10.3819 0.0564418 8.20504 1.68406 8.20504H7.50345C7.85831 8.20514 8.2041 8.08801 8.49132 7.87043C8.77854 7.65285 8.99247 7.34596 9.10248 6.99371L10.9016 1.21441L10.8999 1.21265Z"
            fill="#fafafa"
          />
        </svg>
        <div class="pl-2">{tour.rating}</div>
      </div>

      <div class="mt-6 flex flex-row space-x-5 items-center">
        <div class="">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
            />
          </svg>
          <span class="ml-2">{$tourists}</span>
        </div>
        <div class="">
          <div>Ночей</div>
          <div>{$nights}</div>
        </div>
        <div class="">
          <div>Цена от</div>
          <div>
            ₽ {tour.price * $tourists * $nights}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{#if view}
  <Tour {tour} closeFunction={() => (view = false)} />
{/if}
